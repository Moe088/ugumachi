{\rtf1\ansi\ansicpg932\cocoartf2761
\cocoatextscaling0\cocoaplatform0{\fonttbl\f0\fswiss\fcharset0 Helvetica;}
{\colortbl;\red255\green255\blue255;}
{\*\expandedcolortbl;;}
\paperw11900\paperh16840\margl1440\margr1440\vieww11520\viewh8400\viewkind0
\pard\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\pardirnatural\partightenfactor0

\f0\fs24 \cf0 import \{ useEffect, useMemo, useState \} from "react";\
\
// --- Utility: simple seeded RNG (xorshift32) so results can be shareable via seed ---\
function xorshift(seed) \{\
  let x = seed || Date.now() >>> 0;\
  return () => \{\
    x ^= x << 13; x ^= x >>> 17; x ^= x << 5; // eslint-disable-line no-param-reassign\
    return ((x >>> 0) / 0xFFFFFFFF);\
  \};\
\}\
\
function pickRandom(arr, rng = Math.random) \{\
  return arr[Math.floor(rng() * arr.length)];\
\}\
\
const DEFAULT_FORTUNES = [\
  \{ key: "daikichi", title: "\uc0\u22823 \u21513 ", note: "\u20170 \u26085 \u12399 \u36861 \u12356 \u39080 \u12290 \u12420 \u12373 \u12375 \u12367 \u36914 \u12417 \u12400 \u36947 \u12364 \u25299 \u12369 \u12427 \u12290 ", weight: 8, imageUrl: "/omikuji/01.jpg" \},\
  \{ key: "chukichi", title: "\uc0\u20013 \u21513 ", note: "\u38745 \u12363 \u12394 \u21162 \u21147 \u12364 \u23455 \u12434 \u32080 \u12406 \u12290 \u20104 \u23450 \u36890 \u12426 \u12391 \u12424 \u12356 \u12290 ", weight: 18, imageUrl: "/omikuji/02.jpg" \},\
  \{ key: "shokichi", title: "\uc0\u23567 \u21513 ", note: "\u32937 \u12398 \u21147 \u12434 \u25244 \u12369 \u12400 \u12289 \u24605 \u12431 \u12396 \u21161 \u12369 \u12364 \u12354 \u12427 \u12290 ", weight: 20, imageUrl: "/omikuji/03.jpg" \},\
  \{ key: "kichi", title: "\uc0\u21513 ", note: "\u36523 \u36817 \u12394 \u24184 \u36939 \u12290 \u24863 \u35613 \u12434 \u35328 \u33865 \u12395 \u12377 \u12427 \u12392 \u24195 \u12364 \u12427 \u12290 ", weight: 24, imageUrl: "/omikuji/04.jpg" \},\
  \{ key: "suekichi", title: "\uc0\u26411 \u21513 ", note: "\u28966 \u12425 \u12378 \u12289 \u38918 \u30058 \u12395 \u12290 \u22812 \u12395 \u33391 \u12356 \u30693 \u12425 \u12379 \u12290 ", weight: 16, imageUrl: "/omikuji/05.jpg" \},\
  \{ key: "hanakichi", title: "\uc0\u33457 \u21513 ", note: "\u36259 \u21619 \u20107 \u33391 \u12375 \u12290 \u24425 \u12426 \u12434 \u36275 \u12377 \u12392 \u36939 \u12364 \u21205 \u12367 \u12290 ", weight: 10, imageUrl: "/omikuji/06.jpg" \},\
  \{ key: "kyo", title: "\uc0\u20982 ", note: "\u28961 \u29702 \u12399 \u31105 \u29289 \u12290 \u28201 \u12363 \u12356 \u39154 \u12415 \u29289 \u12391 \u19968 \u24687 \u12290 ", weight: 10, imageUrl: "/omikuji/07.jpg" \},\
  \{ key: "daikyo", title: "\uc0\u22823 \u20982 ", note: "\u23432 \u12426 \u12398 \u26085 \u12290 \u36523 \u12434 \u25972 \u12360 \u12289 \u26126 \u26085 \u12395 \u20633 \u12360 \u12427 \u12290 ", weight: 4, imageUrl: "/omikuji/08.jpg" \},\
  \{ key: "engi", title: "\uc0\u32257 \u36215 \u21513 ", note: "\u20154 \u12392 \u12398 \u32257 \u12364 \u36939 \u12434 \u12402 \u12425 \u12367 \u12290 \u25384 \u25334 \u12434 \u19969 \u23527 \u12395 \u12290 ", weight: 12, imageUrl: "/omikuji/09.jpg" \},\
  \{ key: "komichi", title: "\uc0\u23567 \u36947 \u21513 ", note: "\u36817 \u36947 \u12424 \u12426 \u12418 \u23567 \u36947 \u12290 \u23492 \u12426 \u36947 \u12395 \u23453 \u12354 \u12426 \u12290 ", weight: 12, imageUrl: "/omikuji/10.jpg" \},\
  \{ key: "amairo", title: "\uc0\u38632 \u33394 \u21513 ", note: "\u38632 \u12384 \u12428 \u30707 \u12434 \u31359 \u12388 \u12290 \u23569 \u12375 \u12378 \u12388 \u32154 \u12369 \u12424 \u12290 ", weight: 12, imageUrl: "/omikuji/11.jpg" \},\
  \{ key: "hoshizora", title: "\uc0\u26143 \u31354 \u21513 ", note: "\u22812 \u12289 \u39000 \u12356 \u20107 \u12364 \u23626 \u12365 \u12420 \u12377 \u12356 \u12290 ", weight: 12, imageUrl: "/omikuji/12.jpg" \},\
];\
\
function weightedPick(items, rng) \{\
  const sum = items.reduce((s, it) => s + (Number(it.weight) || 0), 0);\
  let r = rng() * sum;\
  for (const it of items) \{\
    r -= (Number(it.weight) || 0);\
    if (r <= 0) return it;\
  \}\
  return items[items.length - 1];\
\}\
\
function CharmIcon(\{ className = "" \}) \{\
  return (\
    <svg className=\{className\} viewBox="0 0 200 260" aria-hidden>\
      <defs>\
        <linearGradient id="g" x1="0" x2="0" y1="0" y2="1">\
          <stop offset="0%" stopOpacity="1" />\
          <stop offset="100%" stopOpacity="0.9" />\
        </linearGradient>\
      </defs>\
      <rect x="20" y="20" width="160" height="220" rx="18" fill="url(#g)" />\
      <path d="M100 12c-10 0-30 14-30 24 0 6 8 10 30 10s30-4 30-10c0-10-20-24-30-24z" />\
      <circle cx="100" cy="36" r="8" fill="white" />\
    </svg>\
  );\
\}\
\
export default function OmikujiApp() \{\
  const [fortunes, setFortunes] = useState(() => \{\
    const saved = localStorage.getItem("omikuji.fortunes");\
    return saved ? JSON.parse(saved) : DEFAULT_FORTUNES;\
  \});\
  const [branding, setBranding] = useState(() => localStorage.getItem("omikuji.branding") || "\uc0\u12362 \u12415 \u12367 \u12376 ");\
  const [result, setResult] = useState(null);\
  const [rolling, setRolling] = useState(false);\
  const [seedInput, setSeedInput] = useState("");\
\
  // Persist\
  useEffect(() => localStorage.setItem("omikuji.fortunes", JSON.stringify(fortunes)), [fortunes]);\
  useEffect(() => localStorage.setItem("omikuji.branding", branding), [branding]);\
\
  // Seed from URL if present\
  useEffect(() => \{\
    const p = new URLSearchParams(window.location.search);\
    const s = p.get("seed");\
    if (s) setSeedInput(s);\
  \}, []);\
\
  const rng = useMemo(() => \{\
    const n = Number(seedInput);\
    if (!Number.isNaN(n) && seedInput !== "") return xorshift(n);\
    return Math.random;\
  \}, [seedInput]);\
\
  function draw() \{\
    setRolling(true);\
    // simple roll animation delay\
    setTimeout(() => \{\
      const chosen = weightedPick(fortunes, rng);\
      setResult(\{ ...chosen, ts: Date.now() \});\
      setRolling(false);\
    \}, 900);\
  \}\
\
  function reset() \{\
    setResult(null);\
  \}\
\
  function share() \{\
    const seed = seedInput || (Date.now() % 1000000000).toString();\
    const url = new URL(window.location.href);\
    url.searchParams.set("seed", seed);\
    navigator.clipboard.writeText(url.toString());\
    alert("\uc0\u12522 \u12531 \u12463 \u12434 \u12467 \u12500 \u12540 \u12375 \u12383 \u12290 seed\u20184 \u12365 \u12391 \u21516 \u12376 \u32080 \u26524 \u12434 \u20877 \u29694 \u12391 \u12365 \u12427 \u12290 ");\
  \}\
\
  return (\
    <div className="min-h-screen bg-gradient-to-b from-emerald-50 to-white text-slate-800 flex flex-col items-center p-4">\
      <main className="w-full max-w-3xl">\
        \{/* Header */\}\
        <header className="flex items-center justify-between py-6">\
          <h1 className="text-3xl sm:text-4xl font-bold tracking-tight">\
            \{branding\}\
          </h1>\
          <div className="flex gap-2 items-center">\
            <button\
              onClick=\{share\}\
              className="px-3 py-2 rounded-2xl shadow hover:shadow-md transition border"\
              title="\uc0\u32080 \u26524 \u12434 \u20877 \u29694 \u12391 \u12365 \u12427 seed\u20184 \u12365 \u12522 \u12531 \u12463 \u12434 \u12467 \u12500 \u12540 "\
            >\
              \uc0\u20849 \u26377 \u12522 \u12531 \u12463 \
            </button>\
            <details className="group">\
              <summary className="px-3 py-2 rounded-2xl border cursor-pointer select-none">\uc0\u35373 \u23450 </summary>\
              <div className="mt-3 p-4 rounded-2xl border shadow bg-white w-[min(90vw,28rem)]">\
                <label className="block text-sm mb-2">\uc0\u12479 \u12452 \u12488 \u12523  / \u12502 \u12521 \u12531 \u12489 </label>\
                <input\
                  value=\{branding\}\
                  onChange=\{e => setBranding(e.target.value)\}\
                  className="w-full border rounded-xl px-3 py-2 mb-4"\
                  placeholder="\uc0\u12358 \u12368 \u12356 \u12377 \u12398 \u24453 \u12385 \u20154  \u12362 \u12415 \u12367 \u12376 "\
                />\
                <label className="block text-sm mb-2">seed\uc0\u65288 \u21516 \u12376 \u25968 \u23383 \u12394 \u12425 \u21516 \u12376 \u32080 \u26524 \u65289 </label>\
                <input\
                  value=\{seedInput\}\
                  onChange=\{e => setSeedInput(e.target.value.replace(/[^0-9-]/g, ""))\}\
                  className="w-full border rounded-xl px-3 py-2 mb-4"\
                  placeholder="\uc0\u20363 : 20250707"\
                  inputMode="numeric"\
                />\
                <FortuneEditor fortunes=\{fortunes\} setFortunes=\{setFortunes\} />\
              </div>\
            </details>\
          </div>\
        </header>\
\
        \{/* Draw area */\}\
        <section className="mt-6 grid gap-6 sm:grid-cols-2">\
          <div className="order-2 sm:order-1">\
            <div className="rounded-3xl border bg-white p-6 shadow">\
              <h2 className="font-semibold text-lg mb-3">\uc0\u24341 \u12367 </h2>\
              <button\
                disabled=\{rolling\}\
                onClick=\{draw\}\
                className="w-full text-center text-xl font-semibold px-6 py-4 rounded-2xl shadow-lg border bg-emerald-50 hover:bg-emerald-100 active:scale-[.99] disabled:opacity-50"\
              >\
                \{rolling ? "\uc0\u12467 \u12525 \u12467 \u12525 \'85" : "\u12362 \u12415 \u12367 \u12376 \u12434 \u24341 \u12367 "\}\
              </button>\
              \{result && (\
                <button\
                  onClick=\{reset\}\
                  className="mt-3 w-full text-center px-4 py-2 rounded-xl border"\
                >\
                  \uc0\u12418 \u12358 \u19968 \u24230 \
                </button>\
              )\}\
              <p className="text-xs text-slate-500 mt-3">\uc0\u8251 \u37325 \u12415 \u65288 \u20986 \u12420 \u12377 \u12373 \u65289 \u12399 \u35373 \u23450 \u12391 \u35519 \u25972 \u12391 \u12365 \u12427 \u12290 </p>\
            </div>\
          </div>\
\
          <div className="order-1 sm:order-2">\
            <div className="relative overflow-hidden rounded-3xl border bg-white p-6 shadow min-h-[220px] flex items-center justify-center">\
              \{!result ? (\
                <div className="text-center opacity-70">\
                  <CharmIcon className="w-24 h-24 mx-auto mb-2" />\
                  <p>\uc0\u32080 \u26524 \u12399 \u12371 \u12371 \u12395 \u34920 \u31034 \u12373 \u12428 \u12427 \u12290 </p>\
                </div>\
              ) : (\
                <ResultCard result=\{result\} branding=\{branding\} />\
              )\}\
            </div>\
          </div>\
        </section>\
\
        <footer className="mt-10 text-center text-xs text-slate-500">\
          <p>\'a9 \{new Date().getFullYear()\} Omikuji. \uc0\u12371 \u12398 \u12506 \u12540 \u12472 \u12399 \u12471 \u12531 \u12464 \u12523 \u12501 \u12449 \u12452 \u12523 \u12398 React\u12467 \u12531 \u12509 \u12540 \u12493 \u12531 \u12488 \u12391 \u27083 \u25104 \u12373 \u12428 \u12390 \u12356 \u12427 \u12290 </p>\
          <p>Tailwind \uc0\u12364 \u26377 \u21177 \u12394 \u29872 \u22659 \u12391 \u21205 \u20316 \u12377 \u12427 \u12371 \u12392 \u12434 \u24819 \u23450 \u12375 \u12390 \u12356 \u12427 \u65288 ChatGPT\u12398 \u12503 \u12524 \u12499 \u12517 \u12540 \u12391 \u12399 \u33258 \u21205 \u36969 \u29992 \u65289 \u12290 </p>\
        </footer>\
      </main>\
    </div>\
  );\
\}\
\
function ResultCard(\{ result, branding \}) \{\
  const palette = useMemo(() => \{\
    const map = \{\
      daikichi: "bg-amber-50 border-amber-300",\
      chukichi: "bg-emerald-50 border-emerald-300",\
      shokichi: "bg-sky-50 border-sky-300",\
      kichi: "bg-indigo-50 border-indigo-300",\
      suekichi: "bg-lime-50 border-lime-300",\
      kyo: "bg-rose-50 border-rose-300",\
      daikyo: "bg-red-50 border-red-300",\
    \};\
    return map[result.key] || "bg-white";\
  \}, [result]);\
\
  // preload image\
  useEffect(() => \{\
    if (result?.imageUrl) \{\
      const img = new Image();\
      img.src = result.imageUrl;\
    \}\
  \}, [result]);\
\
  return (\
    <div\
      className=\{`w-full max-w-md rounded-2xl border p-4 text-center $\{palette\} animate-in fade-in zoom-in duration-300`\}\
      role="status"\
      aria-live="polite"\
    >\
      <div className="mx-auto aspect-[3/4] w-full max-w-[18rem] overflow-hidden rounded-xl border bg-white">\
        \{result.imageUrl ? (\
          <img src=\{result.imageUrl\} alt=\{`$\{result.title\}\uc0\u12398 \u32080 \u26524 `\} className="w-full h-full object-cover" />\
        ) : (\
          <div className="flex h-full items-center justify-center opacity-50">\
            <CharmIcon className="w-16 h-16" />\
          </div>\
        )\}\
      </div>\
\
      <div className="mt-3 text-xs tracking-wide text-slate-500">\{branding\}</div>\
      <div className="mt-1 text-3xl font-extrabold" aria-label="\uc0\u36939 \u21218 ">\{result.title\}</div>\
      \{result.note && <p className="mt-2 leading-relaxed text-sm">\{result.note\}</p>\}\
      <div className="mt-3 grid grid-cols-2 gap-2 text-xs text-slate-600">\
        <InfoPill label="seed" value=\{new URLSearchParams(location.search).get("seed") || "\'96"\} />\
        <InfoPill label="\uc0\u26178 \u21051 " value=\{new Date(result.ts).toLocaleString()\} />\
      </div>\
    </div>\
  );\
\}\
\
function InfoPill(\{ label, value \}) \{\
  return (\
    <div className="rounded-xl border px-3 py-2 bg-white/70">\
      <div className="text-[10px] uppercase tracking-widest opacity-60">\{label\}</div>\
      <div className="truncate" title=\{String(value)\}>\{value\}</div>\
    </div>\
  );\
\}\
\
function FortuneEditor(\{ fortunes, setFortunes \}) \{\
  const [editing, setEditing] = useState(fortunes);\
  useEffect(() => setEditing(fortunes), [fortunes]);\
\
  function updateItem(i, patch) \{\
    setEditing(prev => prev.map((it, idx) => (idx === i ? \{ ...it, ...patch \} : it)));\
  \}\
\
  function addItem() \{\
    setEditing(prev => [...prev, \{ key: crypto.randomUUID().slice(0, 8), title: "\uc0\u26032 \u12375 \u12356 \u36939 \u21218 ", note: "\u12513 \u12514 ", weight: 10, imageUrl: "/omikuji/new.jpg" \}]);\
  \}\
\
  function removeItem(i) \{\
    setEditing(prev => prev.filter((_, idx) => idx !== i));\
  \}\
\
  function save() \{\
    const normalized = editing.map(it => (\{ ...it, weight: Number(it.weight) || 0 \}));\
    setFortunes(normalized);\
  \}\
\
  return (\
    <div>\
      <div className="flex items-center justify-between mb-2">\
        <h3 className="font-semibold">\uc0\u36939 \u21218 \u12398 \u32232 \u38598 \u65288 \u30011 \u20687 \u23550 \u24540 \u65289 </h3>\
        <button onClick=\{addItem\} className="px-2 py-1 text-sm rounded-lg border">\uc0\u36861 \u21152 </button>\
      </div>\
      <div className="max-h-72 overflow-auto pr-1">\
        \{editing.map((f, i) => (\
          <div key=\{i\} className="grid grid-cols-12 gap-2 items-center mb-2">\
            <input\
              className="col-span-2 border rounded-lg px-2 py-1"\
              value=\{f.title\}\
              onChange=\{e => updateItem(i, \{ title: e.target.value \})\}\
              aria-label="\uc0\u36939 \u21218 \u21517 "\
            />\
            <input\
              className="col-span-6 border rounded-lg px-2 py-1"\
              value=\{f.note || ""\}\
              onChange=\{e => updateItem(i, \{ note: e.target.value \})\}\
              aria-label="\uc0\u35500 \u26126 "\
            />\
            <input\
              type="number"\
              className="col-span-1 border rounded-lg px-2 py-1"\
              value=\{f.weight\}\
              min=\{0\}\
              onChange=\{e => updateItem(i, \{ weight: e.target.value \})\}\
              aria-label="\uc0\u37325 \u12415 "\
              title="\uc0\u20986 \u12420 \u12377 \u12373 \u65288 0\u12316 \u65289 "\
            />\
            <input\
              className="col-span-2 border rounded-lg px-2 py-1"\
              value=\{f.imageUrl || ""\}\
              onChange=\{e => updateItem(i, \{ imageUrl: e.target.value \})\}\
              placeholder="/omikuji/01.jpg"\
              aria-label="\uc0\u30011 \u20687 URL"\
              title="\uc0\u20844 \u38283 \u12469 \u12452 \u12488 \u19978 \u12398 \u30011 \u20687 \u12497 \u12473 \u12414 \u12383 \u12399 URL"\
            />\
            <button onClick=\{() => removeItem(i)\} className="col-span-1 px-2 py-1 rounded-lg border" aria-label="\uc0\u21066 \u38500 ">\'d7</button>\
          </div>\
        ))\}\
      </div>\
      <div className="flex justify-end gap-2 mt-2">\
        <button onClick=\{() => setEditing(DEFAULT_FORTUNES)\} className="px-3 py-1 rounded-xl border">\uc0\u21021 \u26399 \u20516 </button>\
        <button onClick=\{() => setEditing(fortunes)\} className="px-3 py-1 rounded-xl border">\uc0\u25147 \u12377 </button>\
        <button onClick=\{save\} className="px-3 py-1 rounded-xl border bg-emerald-50">\uc0\u20445 \u23384 </button>\
      </div>\
      <p className="text-xs text-slate-500 mt-2">\uc0\u8251  \u30011 \u20687 \u12399 \u12469 \u12452 \u12488 \u12398  <code>/public/omikuji</code> \u12394 \u12393 \u12395 \u32622 \u12367 \u12363 \u12289 \u22806 \u37096 URL\u12434 \u25351 \u23450 \u12290 </p>\
    </div>\
  );\
\}\
}